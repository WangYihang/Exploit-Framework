#!/usr/bin/env python
# encoding: utf-8

import importlib
import glob
from terminaltables import AsciiTable
from core.api.cli.base import BaseCommand

class Command(BaseCommand):

	def __init__(self, context):
		self.context = context

	def help(self):
		print "Help of search"

	def description(self):
		print "Desc of search"

	def run(self, *argc, **argkv):
		keyword = argc[0]
		exploits = glob.glob("weapon/exploit/*/*.py")
		result = [
		    ['Name', 'Version', 'CVE', 'Description', 'Author'],
		]
		for exploit in exploits:
			if keyword in exploit and not "__init__.py" in exploit:
				path = ".".join((exploit[:-len(".py")]).split("/"))
				meta = importlib.import_module(path).Exploit.Meta
				result.append([
					meta.vender['name'],
					meta.max_effected_version,
					"CVE-%04d-%d" % (meta.cve),
					meta.vulnerability,
					",".join(author["name"] for author in meta.authors),
				])
		print(AsciiTable(result).table)