import importlib
import inspect

context = {
	"instance": None,
}

while True:
	if context["instance"]:
		path = inspect.getfile(context["instance"].__class__)
		name = path.split("/")[-3]
		vender = path.split("/")[-2]
		filename = path.split("/")[-1].split(".")[0]
		prompt = "[%s] >> " % ("%s.%s.%s" % (name, vender, filename))
	else:
		prompt = "[%s] >> " % ("Exploit-Framework")
	command_line = raw_input(prompt)
	command_data = command_line.split(" ")
	command = command_data[0]

	if command == "back":
		context["instance"] = None
		continue

	print(context)

	if context["instance"] != None:
		# Dynmic function call
		print("Dynmic function call")
		try:
			getattr(context["instance"], command)(command_data[1:])
		except Exception as e:
			print(repr(e))
		continue

	try:
		module = importlib.import_module("core.commands.%s" % (command))
		instance = module.Command(context)
		instance.run(command_data[1:])
	except Exception as e:
		print(repr(e))
		continue
